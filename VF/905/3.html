<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>ADSR</title>
<style>
*
{
	margin: 0; padding: 0; color: #222;
	font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

html
{
	background: hsl( 210, 80%, 90% );
	padding: 0px 40px;
}

body
{
	min-height: 200vh;
	background: hsl( 210, 0%, 100% );
	padding: 30px 40px;
}

.DIV1 { padding: 0px; }
.SEP { height: 10px; }
.VBOX { padding: 9px 0; }
.VLB { vertical-align: middle; }
button { margin-bottom: 10px; padding: 16px 24px; border-radius: 6px; }

#dummy { color: #fff; }

</style>

<script src="Prime905.js?2019-01-27-A"></script>
<script src="Cell.js?2019-01-27-A"></script>

</head>

<body onload="アプリケーション.初期化()">

<article style="margin-bottom: 60px;">
	<div>
		<button onclick="アプリケーション.ハッシュ取り込み()">URLハッシュ取り込み</button>
		<button onclick="アプリケーション.ハッシュ書き出し()">URLハッシュ書き出し</button>
		<button onclick="location.hash = ''">クリア</button>
		<br/>
		<textarea id="JSON" style="width: 500px; height: 300px;"></textarea>
	</div>
</article>

<article class="EVAL">
	<button onclick="アプリケーション.スクリプト実行()">スクリプト実行</button><br/>
	<textarea id="Eval_Code" style="width: 500px; height: 80px;"></textarea>
	<textarea id="Eval_Output" style="width: 500px; height: 40px;"></textarea>
</article>

<script>

const アプリケーション = new function()
{
	const json = この文書.Idで( "JSON" );

	this.初期化 = function()
	{
		const 楽音モデル = 楽音モデルの型.作成();
		this.Value =
		{
			"表題":"山手線 外回り",
			"停車駅":"池袋－大塚－巣鴨－駒込－田端－西日暮里－日暮里－鶯谷－上野－御徒町－秋葉原－神田－東京－有楽町－新橋－浜松町－田町－高輪ゲートウエイ－品川－大崎－五反田－目黒－恵比寿－渋谷－原宿－代々木－新宿－新大久保－高田馬場－目白－池袋",
			Ti:"整数比の楽音",Fs:[330,440],EG:{A:100,D:1000,S:50,R:100}
		};
		json.value = JSON.stringify( this.Value, null, "\t" );
	};

	this.ハッシュ取り込み = function()
	{
		//console.clear();
		this.Value = JSON.parse( decodeURI( location.hash.substr( 1 ) ) );
		//console.log( JSON.stringify( this.Value, null, "\t" ) );
		json.value = JSON.stringify( this.Value, null, "\t" );
	};

	this.ハッシュ書き出し = function()
	{
		this.Value = JSON.parse( json.value );
		location.hash = "#" + encodeURI( JSON.stringify( this.Value ) );
	};

	this.スクリプト実行 = function()
	{
		const 出力 = この文書.Idで( "Eval_Output" );
		try
		{
			出力.value = eval( この文書.Idで( "Eval_Code" ).value );
		}
		catch( 例外 )
		{
			出力.value = 例外.toString();
		}
	};
};

//  //

const 楽音モデルの型 = 拡張型を作成
(
	値セル群.オブジェクトの型,
	function()
	{
		const プロトタイプ = this;

		プロトタイプ.初期化 = function()
		{
			const これ = this;

			これ.EG = EGモデルを作成();
		};
	}
);

const EGモデルを作成 = function()
{
	const オブジェクト = 値セル群.オブジェクトの型.作成();

	オブジェクト.数値フィールドを追加( "アタック", "A", 0 );
	オブジェクト.数値フィールドを追加( "ディケイ", "D", 1000 );
	オブジェクト.数値フィールドを追加( "サステイン", "S", 70 );
	オブジェクト.数値フィールドを追加( "リリース", "R", 30 );

	return オブジェクト;
}


</script>
</body>
</html>