<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>VF903-1</title>
<script src="../../Base/Prime.js"></script>
<script src="./VF903-Common.js"></script>
<style>
*
{
	margin: 0; padding: 0;
	font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

html
{
	background: hsl( 210, 60%, 90% );
	padding: 50px;
}

body
{
	margin: 0px auto;
	width: 720px;
	padding: 40px 40px;
	border-radius: 16px;
	min-height: 90vh;
	background: #fff;
}

button { font-size: 16px; }
button { padding: 16px 24px; }

.PAD1
{
	pointer-events: ;
	border: 3px solid hsl( 30, 6%, 60% );
	background: hsl( 180, 70%, 96% );
	border-radius: 11px;
	width: 280px; height: 280px; margin-bottom: 30px;
}

.INPUT_TABLE { border: 1px solid #999; padding: 12px; }
.INPUT_TABLE .CAP { font-size: 13px; }
.INPUT_TABLE .INPUT { margin: 0 0.2ex 0 1ex; width: 110px; height: 34px; font-size: 18px; }
.INPUT_TABLE .UNIT { font-size: 14px; }
.INPUT_TABLE .RANGE { margin: 0 1ex; width: 400px; padding: 6px }

</style>
</head>
<body onload="メイン.はじめよ();">
<script>

let メイン = new function()
{
	let これ = this;

	これ.はじめよ = function()
	{
		これ.アプリ画面 = new アプリ画面の型();
	};
};

let アプリ画面の型 = 型をつくります
(
	なし,
	function()
	{
		let この型 = this;

		この型.はじめる = function()
		{
			let この実体 = this;

			この実体.モデル = new アプリの型();

			この実体.エレメント = divエレメントをつくれ( この文書.body, { クラス: "APP" } );
			pエレメントをつくれ( この実体.エレメント, { 文: "VF903-1" } );
			この実体.表示1 = pエレメントをつくれ( この実体.エレメント, { 文: ".." } );

			let 減速3ボタン = ボタンをつくれ( この実体.エレメント, { 文: "減速3" } );
			let 減速2ボタン = ボタンをつくれ( この実体.エレメント, { 文: "減速2" } );
			let 減速1ボタン = ボタンをつくれ( この実体.エレメント, { 文: "減速1" } );
			let 切りボタン = ボタンをつくれ( この実体.エレメント, { 文: "切り" } );
			let 加速1ボタン = ボタンをつくれ( この実体.エレメント, { 文: "加速1" } );
			let 加速2ボタン = ボタンをつくれ( この実体.エレメント, { 文: "加速2" } );
			let 加速3ボタン = ボタンをつくれ( この実体.エレメント, { 文: "加速3" } );

			減速3ボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( -3 ); } );
			減速2ボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( -2 ); } );
			減速1ボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( -1 ); } );
			切りボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( 0 ); } );
			加速1ボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( 1 ); } );
			加速2ボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( 2 ); } );
			加速3ボタン.クリックされた( function( イベント ) { この実体.モデル.列車.加速度.値を設定( 3 ); } );

			// 発進ボタン.タッチスタートされたよ( 定型動作を抑止 );
			
			function 定型動作を抑止( イベント )
			{
				イベント.本来の動作を阻止();
				コンソール.クリアー();
				コンソール.ログ( イベント );
			}

			この実体.シンセ =　new モハシンセの型( この実体.モデル.列車 );

			この実体.モデル.コマが進んだ = function()
			{
				この実体.情報表示を更新();
			}
		};

		この型.情報表示を更新 = function()
		{
			let この実体 = this;
			let 列車 = この実体.モデル.列車;
			let 速度 = 桁を整理( 列車.速度.値, 0 );
			let 加速度 = 桁を整理( 列車.加速度.値, -1 );

			この実体.表示1.innerHTML = `加速度：${加速度}km/h/s  速度：${速度}km/h`;

			この実体.シンセ.更新せよ();
		}
	}
);

// 実体 //

let アプリの型 = 型をつくります
(
	なし,
	function()
	{
		let この型 = this;

		この型.はじめる = function()
		{
			let この実体 = this;

			この実体.コマの長さ = 100;  //  ミリ秒
			この実体.列車 = new 列車の型();
			この実体.コマが進んだ = なし;

			間欠を設定( function() { この実体.コマを進める(); }, この実体.コマの長さ );
		};

		この型.コマを進める = function()
		{
			let この実体 = this;

			この実体.列車.コマを進めよ( この実体.コマの長さ );
			この実体.コマが進んだ && この実体.コマが進んだ( この実体.コマの長さ );
		};
	}
);


let 列車の型 = 型をつくります
(
	なし,
	function()
	{
		let この型 = this;

		この型.はじめる = function()
		{
			let これ = this;

			これ.状態 = new 値の型( "" );
			これ.加速度 = new 値の型( 0 );
			これ.惰行減速度 = new 値の型( 0 );

			これ.速度 = new 値の型( 0 );
			これ.動力車 = new 動力車の型();
		};

		この型.コマを進めよ = function( ミリ秒 )
		{
			let これ = this;

			これ.速度.値 += これ.加速度.値 * ミリ秒 / 1000;
			if( これ.速度.値 <= 0 ) これ.速度.値 = 0;
		};
	}
);


let 動力車の型 = 型をつくります
(
	無,
	function()
	{
		let この型 = this;  //  背景典型実体  //

		この型.はじめる = function()
		{
			let これ = this;

			これ.車輪径 = new 値の型( 860 );
			これ.動力側歯数 = new 値の型( 17 );
			これ.車輪側歯数 = new 値の型( 82 );
		};
	}
);

// 表示 //


// 発音器 //

let モハシンセの型 = 型をつくります
(
	なし,
	function()
	{
		let この型 = this;

		この型.はじめる = function( 列車 )
		{
			let これ = this;
			これ.列車 = 列車;

			let 音響文脈 = new 音響文脈の型();
			let オシレーター1 = 音響文脈.オシレーターを作成();
			let 音量ゲート = 音響文脈.ゲートを作成();

			オシレーター1.接続( 音量ゲート );
			音量ゲート.接続( 音響文脈.出力先() );

			オシレーター1.周波数().値( 0 );
			オシレーター1.開始();

			コンソール.ログ( オシレーター1.周波数() );

			これ.音響文脈 = 音響文脈;
			これ.音量ゲート = 音量ゲート;
			これ.オシレーター1 = オシレーター1;
			これ.更新せよ();
		};

		この型.更新せよ = function()
		{
			let これ = this;
			これ.オシレーター1.周波数().値( これ.列車.速度.値 * 10 );
		};

		this.ノートを処理せよ = function(  )
		{
			;
		};
	}
);



//  //

//  //


</script>
</body>
</html>