<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Site1</title>
<script src="prime.js"></script>
<script src="EQFS.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhQjsoTBqzC7xqEpe84bjKW5vTgZnzwl8&callback=initMap"></script>
<link rel="stylesheet" type="text/css" href="qrafts.css"/>
<style>

.App
{
	width: 1051px;
	height: 550px;
}

.SiteList
{
	display: inline-block;
	cursor: default;
	width: 300px;
	height: 100%;
	overflow: auto;
	font-size: 14px;
}

.SiteList .Item
{
	height: 42px;
	line-height: 42px;
	border-bottom: 1px dotted #999988;
	white-space: nowrap;
	overflow-x: hidden; 
}

.SiteList .Item.Selected
{
	background: #333333;
	color: #f6f5f0;
}


.Map
{
	display: inline-block;
	width: 750px;
	height: 100%;
	margin-left: 1px;
	background: #e8ecfc;
}

</style>
</head>
<body>
<header>

</header>
<article id="Content"></article>
<script>
let gmapkey = "AIzaSyBhQjsoTBqzC7xqEpe84bjKW5vTgZnzwl8";

function main()
{
	new AppPane( q.id( "Content" ) );
}

function initMap(){}

function AppPane( com )
{
	let self = this;
	let mappane;

	let e = q.div( com, { "class": "App" } );
	{
		new ListPane( e, EQFS.SiteList, onselchange );
		mappane = new MapPane( e );
	}

	function onselchange( site )
	{
		mappane.SetCenter( site.lat, site.long );
	};
}

function ListPane( com, list, onselchange )
{
	var curitem;

	let e = q.div( com, { "class": "SiteList" } );
	let fr = q.fr();
	q.p( e, { "text": "count: " + list.count } );
	for( var id in list )
	{
		new ListItem( e, list[ id ], this );
	}
	e.appendChild( fr );

	this.onitemselect = function( item, value )
	{
		onselchange( value );
		if( curitem ) curitem.setselected( false );
		curitem = item;
		if( curitem ) curitem.setselected( true );
	}
}


function ListItem( com, value, pane )
{
	let self = this;
	var e = q.div( com, { "class": "Item",
		"text": [ value.code, value.name, value.namer ].join( " - " )
	});

	e.onclick = function()
	{
		pane.onitemselect( self, value );
	};

	this.setselected = function( value )
	{
		q.setc( e, "Selected", value );
	};
}

function MapPane( com )
{
	let center = { "lat": 36, "lng": 138};

	let e = q.div( com, { "class": "Map" } );
	this.gmap = new google.maps.Map( e, { "center": center, "zoom": 7 } );

	let cmark = new google.maps.Marker( { "position": center, "map": this.gmap } );

	this.SetCenter = function( lat, lng )
	{
		center = { "lat": lat, "lng": lng };
		this.gmap.panTo( new google.maps.LatLng( lat, lng ) );
		setTimeout
		(
			function() { cmark.setPosition( new google.maps.LatLng( lat, lng ) ); },
			200
		)
	};
}

let Hash = new function()
{
	this.Set = function( value )
	{
		location.h = value;
	};
};

document.body.onload = main;

</script>
</body>
</html>
