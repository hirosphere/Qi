<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Site1</title>
<script src="Files/Prime.js"></script>
<script src="Files/EQFS.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhQjsoTBqzC7xqEpe84bjKW5vTgZnzwl8&callback=initMap"></script>
<style>

html { font-size: 13px; }

.App
{
	width: 1051px;
	height: 550px;
}

.SiteList
{
	display: inline-block;
	cursor: default;
	width: 300px;
	height: 100%;
	overflow: auto;
	font-size: 14px;
}

.SiteList .Item
{
	height: 42px;
	line-height: 42px;
	border-bottom: 1px dotted #999988;
	white-space: nowrap;
	overflow-x: hidden; 
}

.SiteList .Item.Selected
{
	background: #333333;
	color: #f6f5f0;
}


.Content
{
	display: inline-block;
	width: 750px;
	height: 100%;
	vertical-align: top;
	margin-left: 1px;
	background: #e8ecfc;
}

.Map
{
	width: 100%;
	height: 80%;
}
</style>
</head>
<body>
<header>

</header>
<article id="Content"></article>
<script>
let gmapkey = "AIzaSyBhQjsoTBqzC7xqEpe84bjKW5vTgZnzwl8";

function main()
{
	EQFS.Init
	(
		function() { new AppPane( q.id( "Content" ) ); }
	);
}

function initMap(){}

function AppPane( com )
{
	let self = this;
	let mappane;

	let e = q.div( com, { "class": "App" } );
	{
		new ListPane( e, EQFS.SiteList, onselchange );
		mappane = new MapPane( e );
	}

	function onselchange( site )
	{
		// mappane.SetCenter( site.lat, site.long );
		mappane.SetSite( site );
	};
}

function ListPane( com, list, onselchange )
{
	var curitem;

	let e = q.div( com, { "class": "SiteList" } );
	let fr = q.fr();
	//q.p( e, { "text": "count: " + list.count } );
	for( var id in list )
	{
		new ListItem( e, list[ id ], this );
	}
	e.appendChild( fr );

	this.onitemselect = function( item, value )
	{
		onselchange( value );
		if( curitem ) curitem.setselected( false );
		curitem = item;
		if( curitem ) curitem.setselected( true );
	}
}


function ListItem( com, value, pane )
{
	let self = this;
	var e = q.div( com, { "class": "Item",
		"text": [ value.code, value.name, value.namer ].join( " - " )
	});

	e.onclick = function()
	{
		pane.onitemselect( self, value );
	};

	this.setselected = function( value )
	{
		q.setc( e, "Selected", value );
	};
}

function MapPane( com )
{
	let center = { "lat": 36, "lng": 138 };

	let e = q.div( com, { "class": "Content" } );
	let mapdiv = q.div( e, { "class": "Map" } );
	this.gmap = new google.maps.Map
	(
		mapdiv, { "center": center, "zoom": 7, "scaleControl": true }
	);

	let info = new InfoPane( e );

	let cmark = new google.maps.Marker( { "position": center, "map": this.gmap } );

	this.SetSite = function( site )
	{
		center = { "lat": site.lat, "lng": site.long };
		this.gmap.panTo( new google.maps.LatLng( site.lat, site.long ) );
		info.SetSite( site );
		setTimeout
		(
			function() { cmark.setPosition( new google.maps.LatLng( site.lat, site.long ) ); },
			210
		)
	};
}

function InfoPane( com )
{
	let e = q.table( com, { style: { width: "600px" } } );
	let r1 = new row( e, "北緯" );
	let r2 = new row( e, "東経" );
	let r3 = new row( e, "標高" );
	let r4 = new row( e, "地中センサ深さ" );

	function row( table, title )
	{
		this.tr = q.tr( table );
		this.hd = q.td( this.tr, { "class": "rowhead", text: title } );
		this.col = q.td( this.tr );
	}

	this.SetSite = function( site )
	{
		q.text( r1.col, site.lat );
		q.text( r2.col, site.long );
		q.text( r3.col, site.elev );
		q.text( r4.col, site.dep );
	};
}

let Hash = new function()
{
	this.Set = function( value )
	{
		location.h = value;
	};
};

document.body.onload = main;

</script>
</body>
</html>
